var express = require('express');
var app = express();
var port = 8080;
var path = require('path')
<<<<<<< HEAD
app.use(express.static(path.join(__dirname,'client/public')));
=======
app.use(express.static(path.join(__dirname + '/../client/public')));
>>>>>>> 36c4c44a4740a74423f6e3d417d5e6fef80344ff
var config = require('../config');
var options = new config(false);
options = options.getOptions();
var axios = require('axios')
var bp = require('body-parser')
app.use(bp.json())
var cors = require('cors');


app.use(cors());
<<<<<<< HEAD


app.get('/getData',function(request, response) {
  var url = options.APIURL;
  if (request.query.route){
    url+=`/${request.query.route}?`;
  }
  Object.keys(request.query).forEach((param)=>{
    console.log('url',url)
    console.log(param)
    var value = request.query[param];
    if (param !== 'route'){
      url+=`&${param}=${value}`;
    }
  });
=======
app.use(express.static(path.join(__dirname,'../client/public')));

//changed this file to accept an array of routes in order and removed query params. you must have an array and a callback
app.get('/getData',function(request, response) {
  var url = options.APIURL;
  if (request.query.route1){
    url+=`/${request.query.route1}`;
  }
  if (request.query.route2){
    url+=`/${request.query.route2}`;
  }
  if (request.query.route3){
    url+=`/${request.query.route3}`;
  }


  console.log('url',url)
>>>>>>> 36c4c44a4740a74423f6e3d417d5e6fef80344ff
  axios({
    method: 'get',
    url:url,
    headers:{'authorization':`${options.APIKEY}`,'Accept':'*'}
  }).then(function(results){
<<<<<<< HEAD
    console.log(results);
=======
>>>>>>> 36c4c44a4740a74423f6e3d417d5e6fef80344ff
    if (results.data){
      response.json({results:results.data});
    } else {
      response.json({Error: new Error('no data')})
    }
  }).catch(err=>{
    response.json({results:[],Error:err});
  });

})

<<<<<<< HEAD
app.listen(port,function(){
  console.log('listenening on ',port)
})
=======

app.listen(port,function(){
  console.log('listenening on ',port)
})

>>>>>>> 36c4c44a4740a74423f6e3d417d5e6fef80344ff
